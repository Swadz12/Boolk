@page "/register"
@using System.ComponentModel.DataAnnotations
@inject UserService UserService
@inject NavigationManager Nav

<PageTitle>Register - Boolk</PageTitle>

<div class="container" style="display: flex; justify-content: center; align-items: center; min-height: 80vh; padding: 2rem;">
    <div class="card" style="max-width: 400px; width: 100%; padding: 2rem;">
        <div class="card-header">
            <h2 class="card-title">✨ Register</h2>
        </div>

        <div class="card-body" style="display: flex; flex-direction: column; gap: 1rem;">
            <EditForm Model="registerModel" OnValidSubmit="HandleRegister">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div class="form-group">
                    <label>Name</label>
                    <InputText @bind-Value="registerModel.Name" type = "name" class = "form-control" placeholder = "Enter your name"></InputText>


                </div>
                
                
                <div class="form-group">
                    <label>Email</label>
                    <InputText @bind-Value="registerModel.Email" type="email" class="form-control" placeholder="Enter your email" />
                </div>
                
                <div class=form-group>
                    <label>Birth Date</label>
                    <InputDate @bind-Value="registerModel.BirthDate" class="form-control" placeholder = DateTime />
                    
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <InputText @bind-Value="registerModel.Password" type="password" class="form-control" placeholder="Enter your password" />
                </div>

                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    <p style="color:red">@errorMessage</p>
                }

                <button class="btn btn-primary" type="submit" disabled="@isSubmitting">
                    @(isSubmitting ? "Loading..." : "Register")
                </button>
            </EditForm>
        </div>

        <div class="card-footer" style="text-align: center; margin-top: 1rem;">
            <a href="/login">Already have an account? Login</a>
        </div>
    </div>
</div>

@code {
    private bool isSubmitting = false;
    private string? errorMessage;
    private RegisterModel registerModel = new();

    private async Task HandleRegister()
    {
        isSubmitting = true;
        errorMessage = null;

        try
        {
            await UserService.RegisterUser(registerModel.Email,registerModel.Name,registerModel.BirthDate, registerModel.Password);
            Nav.NavigateTo("/profile");
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message; // Wyświetl komunikat dla użytkownika
        }
        finally
        {
            isSubmitting = false;
        }
    }

    public class RegisterModel
    {
        [Required(ErrorMessage = "Email is required")]
        [EmailAddress(ErrorMessage = "Invalid email address")]
        public string Email { get; set; } = "";

        [Required(ErrorMessage = "Password is required")]
        public string Password { get; set; } = "";

        [Required(ErrorMessage = "Name is required")]
        public string Name { get; set; } = "";

        [Required(ErrorMessage = "Birth Date is required")]
        public DateTime BirthDate { get; set; } = DateTime.Today;
    }
}
